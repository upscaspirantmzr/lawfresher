<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<h2>Admin Dashboard</h2>
<button id="logoutBtn">Logout</button>

<div class="panel" id="panel">
<h3>Add Candidate</h3>
<input id="cName" placeholder="Candidate Name" />
<input id="cRoll" placeholder="Roll Number" />
<button id="addCandidateBtn">Add Candidate</button>
<p id="status"></p>

<h3>Live Results</h3>
<div id="results"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { firebaseConfig } from "./firebaseConfig.js";

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

if(!localStorage.getItem("adminEmail")){ window.location.href="admin-login.html"; }

document.getElementById("logoutBtn").addEventListener("click", ()=>{
  localStorage.removeItem("adminEmail");
  window.location.href="admin-login.html";
});

document.getElementById("addCandidateBtn").addEventListener("click", async ()=>{
  const name = document.getElementById("cName").value.trim();
  const roll = document.getElementById("cRoll").value.trim();
  if(!name || !roll) { alert("Enter details"); return; }
  await addDoc(collection(db,"candidates"), {name, roll, votes:0});
  document.getElementById("status").innerText = "âœ… Candidate added";
  loadResults();
});

async function loadResults(){
  const snap = await getDocs(collection(db,"candidates"));
  let html="";
  snap.forEach(doc=>{
    const c = doc.data();
    html+= `<p>${c.name} (${c.roll}) - Votes: ${c.votes}</p>`;
  });
  document.getElementById("results").innerHTML = html;
}

loadResults();
</script>
</body>
</html>
