<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Scanner - Entry Verification</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-r from-gray-800 to-black text-white min-h-screen flex flex-col items-center justify-center">

  <h1 class="text-3xl font-bold mb-6">ğŸ” Entry Verification</h1>
  <video id="preview" class="w-80 h-60 border-4 border-purple-600 rounded-xl"></video>
  <p id="status" class="mt-4 text-lg"></p>
  <div id="result" class="mt-6 hidden bg-purple-700 p-4 rounded-xl"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { firebaseConfig } from "./js/firebaseConfig.js";
    import QrScanner from "https://cdn.jsdelivr.net/npm/qr-scanner@1.4.2/qr-scanner.min.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const videoElem = document.getElementById("preview");
    const statusElem = document.getElementById("status");
    const resultElem = document.getElementById("result");

    const scanner = new QrScanner(videoElem, async result => {
      statusElem.textContent = "âœ… QR detected, verifying...";
      try {
        const data = JSON.parse(result.data || result); 
        const docRef = doc(db, "fresherIDs", data.id);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
          const user = docSnap.data();
          resultElem.innerHTML = `
            <h2 class="text-xl font-bold">âœ” Verified Entry</h2>
            <p><b>Name:</b> ${user.name}</p>
            <p><b>Roll:</b> ${user.roll}</p>
            <p><b>Nickname:</b> ${user.nickname}</p>
          `;
          resultElem.classList.remove("hidden");
          statusElem.textContent = "ğŸ‰ Entry Approved";
        } else {
          statusElem.textContent = "âŒ Invalid ID";
        }
      } catch (e) {
        statusElem.textContent = "âš ï¸ Error: Invalid QR";
      }
    });

    scanner.start();
  </script>
</body>
</html>
